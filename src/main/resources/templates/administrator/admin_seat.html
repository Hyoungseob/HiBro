<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layouts/layout2}">
<head>
	<meta name="_csrf" th:content="${_csrf.token}" />
	<meta name="_csrf_header" th:content="${_csrf.headerName}" />
</head>

<th:block layout:fragment="css">
	<link rel="stylesheet" th:href="@{/css/administrator/board.css}">
	<link rel="stylesheet" th:href="@{/css/administrator/theater.css}">
	<style>
		.on {
			display: inline-block;
			margin: 0;
		}

		.off {
			display: none;
			margin: 0;
		}
	</style>
</th:block>

<th:block layout:fragment="script">
	<script th:inline="javascript">
		function deleteSeat(obj) {
			var token = $("meta[name='_csrf']").attr("content");
			var header = $("meta[name='_csrf_header']").attr("content");

			var screenDateCode = obj.dataset.screen_date;
			var seatCode = obj.dataset.seat;

			var url = "/admin/seat/" + seatCode;

			$.ajax({
				url: url,
				type: "DELETE",
				beforeSend: function (xhr) {
					xhr.setRequestHeader(header, token);
				},
				dataType: "json",
				cache: false,
				success: function (result, status) {
					location.href = '/admin/screenDate/' + screenDateCode;
				},

				error: function (jqXHR, status, error) {
					if (jqXHR.status == '401') {
						alert('로그인 후 이용해주세요');
						location.href = '/member/login';
					} else {
						alert(jqXHR.responseJSON.message);
					}
				}
			});
		}

		function isUpdate(obj) {
			var code = obj.dataset.code;
			var on = document.getElementsByClassName("on" + code);
			var off = document.getElementsByClassName("off" + code);

			for (var i = 0; i < on.length; i++) {
				on[i].classList.remove("on");
				on[i].classList.add("off");
			}
			for (var i = 0; i < off.length; i++) {
				off[i].classList.remove("off");
				off[i].classList.add("on");
			}
		}
	</script>
</th:block>
<div layout:fragment="content">
	<!--사용자 창 시작-->
	<div class="noticeBoard">
		<div>
			<th:block>
				<h2 class="allMember" th:text="${theater.theaterName} + ' ' + ${screen.code} + '관 ' + ${#temporals.format(screenDate.screeningDateTime, 'yyyy년 MM월 dd일 HH시 mm분')} + ' 시간의 좌석 현황'"></h2>
			</th:block>
		</div>
		<div class="board_list_wrap">
			<div class="board_list">
				<div class="top"> <!--첫번째 줄만 스타일을 다르게 주기위해 top 클래스를 주었음.-->
					<div class="theater_code">번호</div>
					<div class="theater_location">행</div>
					<div class="theater_type">열</div>
					<div class="theater_type">상태</div>
				</div>
				<th:block th:each="seat, status:${seatList}">
					<div>
						<div class="theater_code">[[${seat.code}]]</div>
						<div class="theater_location">[[${seat.seatColumn}]]</div>
						<div class="theater_status">[[${seat.seatRow}]]</div>
						<div class="theater_status">[[${seat.seatStatus}]]</div>
						<div class="screenDate_updatebtn">
							<button th:class="on+${seat.code} + ' on'" th:data-code="${seat.code}"
							        onclick="isUpdate(this)">수정</button>
							<button th:class="off+${seat.code} + ' off'" th:data-code="${seat.code}"
							        th:data-point="10" onclick="updateSeat(this)">수정</button>
						</div>
						<div class="screenDate_deletebtn">
							<button th:data-screen_date="${screenDate.code}" th:data-seat="${seat.code}"
							        onclick="deleteSeat(this)">삭제</button>
						</div>
					</div>
				</th:block>
			</div>
			<div class="board_page">
				<a href="#" class="bt first">
				</a>
				<a href="#" class="bt prev">
				</a>
				<a href="#" class="num on">1</a>
				<a href="#" class="bt">2</a>
				<a href="#" class="bt">3</a>
				<a href="#" class="bt">4</a>
				<a href="#" class="bt">5</a>
				<a href="#" class="bt next">></a>
				<a href="#" class="bt last">>></a>
			</div>
			<th:block>
				<div class="bt_wrap">
					<a th:href="'/admin/screenDate/' + ${screenDate.code} + '/new'">등록하기</a>
				</div>
			</th:block>
		</div>
	</div>
</div>

</html>